<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeshDepthMaterial</title>
    <script src="./../build/three.js"></script>
    <script src="./../examples/js/libs/stats.min.js"></script>
    <script src="./../examples/js/libs/dat.gui.min.js"></script>
</head>
<body>
    <script>
        var renderer;
        function initRender()
        {
            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(window.innerWidth,window.innerHeight);
            document.body.appendChild(renderer.domElement);
        }

        var scene;
        function initScene()
        {
            scene = new THREE.Scene();
        }

        var camera;
        function initCamera()
        {
            camera = new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1000);
            camera.position.set(30,20,60);
            camera.lookAt(new THREE.Vector3(0,0,0));
        }

        function initModel()
        {
            var helper = new THREE.AxesHelper(10);
            scene.add(helper);

            var cubeGeometry = new THREE.BoxGeometry(25,25,25);
            var cubeMaterial = new THREE.MeshDepthMaterial();

            for(var i=0;i<3000;i++)
            {
                var cube = new THREE.Mesh(cubeGeometry,cubeMaterial);
                
                cube.position.x = 800 * ( 2.0 * Math.random( ) - 1.0 );
                cube.position.y = 800 * ( 2.0 * Math.random( ) - 1.0 );
                cube.position.z = 800 * ( 2.0 * Math.random( ) - 1.0 );

                cube.rotation.x = Math.random ( ) * Math.PI;
                cube.rotation.y = Math.random ( ) * Math.PI;
                cube.rotation.z = Math.random ( ) * Math.Pi;

                cube.updateMatrix();

                scene.add(cube);

            }
        }

        var stats;
        function initStats()
        {
            stats = new Stats();
            document.body.appendChild(stats.dom);
        }

        function render()
        {
            renderer.render(scene,camera);
        }

        function onWindowResize()
        {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth , window.innerHeight);
        }

        function animate()
        {
            render();
            stats.update();
            requestAnimationFrame(animate);
        }

        function draw()
        {
            initRender();
            initScene();
            initCamera();
            initModel();
            initStats();
            animate();
            window.onresize = onWindowResize;
        }
        draw();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光晕</title>
    <script type="importmap">
        {
            "imports": {
                "three": "./../build/three.module.js"
            }
        }
</script>
</head>

<body>

</body>
<script type="module">
    import * as THREE from './../build/three.module.js'
    import { OrbitControls } from './../examples/jsm/controls/OrbitControls.js'
    import Stats from './../examples/jsm/libs/stats.module.js'
    import { Lensflare, LensflareElement } from './../examples/jsm/objects/Lensflare.js'
    var scene;
    function initScene() {
        scene = new THREE.Scene();
    }

    var renderer;
    function initRender() {
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window, innerHeight);
        document.body.appendChild(renderer.domElement);
    }

    var camera;
    function initCamera() {
        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(100, 200, 50);
        camera.lookAt(new THREE.Vector3(0, 0, 0));
    }

    var light;
    function initLight() {
        light = new THREE.PointLight(0xffffff);
        light.position.set(0, 100, 50);
        scene.add(light);
    }

    var lensFlare;
    function initLensFlare() {
        var textureLoader = new THREE.TextureLoader();

        var textureFlare0 = textureLoader.load("./../素材/光晕纹理1.png");
        var textureFlare2 = textureLoader.load("./../素材/光晕纹理2.png");
        var textureFlare3 = textureLoader.load("./../素材/光晕纹理3.png");

        var flareColor = new THREE.Color(0xffffff);
        flareColor.setHSL(0.55, 0.9, 1.0);
        var lensFlare = new Lensflare(textureFlare0, 500, 0.0, THREE.AdditiveBlending, flareColor);//新的写法

        // lensFlare.add(textureFlare2, 512, 0.0, THREE.AdditiveBlending);
        // lensFlare.add(textureFlare2, 512, 0.0, THREE.AdditiveBlending);
        // lensFlare.add(textureFlare2, 512, 0.0, THREE.AdditiveBlending);

        // lensFlare.add(textureFlare3, 60, 0.6, THREE.AdditiveBlending);
        // lensFlare.add(textureFlare3, 70, 0.7, THREE.AdditiveBlending);
        // lensFlare.add(textureFlare3, 120, 0.9, THREE.AdditiveBlending);
        // lensFlare.add(textureFlare3, 70, 1.0, THREE.AdditiveBlending);
        lensFlare.addElement(new LensflareElement(textureFlare0, 512, 0));//新的写法
        lensFlare.addElement(new LensflareElement(textureFlare2, 512, 0));
        lensFlare.addElement(new LensflareElement(textureFlare3, 60, 0.6));
        // lensFlare.position.copy(light.position);
        light.add(lensFlare)

        // scene.add(lensFlare);
    }

    var cube, plane;
    function initModel() {
        var cubeGeometry = new THREE.BoxGeometry(5, 5, 5);
        var cubeMaterial = new THREE.MeshPhongMaterial({ color: "blue", side: THREE.DoubleSide });
        cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
        cube.position.set(0, 5, 0);
        scene.add(cube);

        var planeGeometry = new THREE.PlaneGeometry(40, 60);
        var planeMaterial = new THREE.MeshPhongMaterial({ color: "pink", side: THREE.DoubleSide });
        plane = new THREE.Mesh(planeGeometry, planeMaterial);
        scene.add(plane);
    }

    var controls;
    function initControls() {
        controls = new OrbitControls(camera, renderer.domElement);
    }

    var stats;
    function initStats() {
        stats = new Stats();
        document.body.appendChild(stats.domElement);
    }

    function Render() {
        renderer.render(scene, camera);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        Render();
        stats.update();
        controls.update();
        requestAnimationFrame(animate);
    }

    function draw() {
        initScene();
        initRender();
        initCamera();
        initLight();
        initLensFlare();
        initModel();
        initStats();
        initControls();
        animate();
        window.onresize = onWindowResize;
    }
    draw();
</script>

</html>
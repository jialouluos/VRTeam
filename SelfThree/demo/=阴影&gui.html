<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./../build/three.js"></script>
    <script src="./../examples/js/controls/OrbitControls.js"></script>
    <script src="./../examples/js/libs/stats.min.js"></script>
    <script src="./../examples/js/libs/dat.gui.min.js"></script>
</head>
<body>
    <script>
        var renderer;
        function initRender()
        {
            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(window.innerWidth,window.innerHeight);
            renderer.shadowMap.enabled = true;//告诉渲染器我需要阴影，你给我生成阴影
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;//默认的没有这个设置的阴影更清晰
            document.body.appendChild(renderer.domElement);
        }

        var camera;
        function initCamera()
        {
            camera = new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1000);
            camera.position.set(30,20,60)
            camera.lookAt(new THREE.Vector3(0,0,0))
        }

        var scene;
        function initScene()
        {
            scene = new THREE.Scene();
        }

        var light;
        function initLight()
        {
            light = new THREE.PointLight(0xffffff);
            light.position.set(60,30,20);
            light.castShadow = true;//告诉灯光我需要阴影
            scene.add(light);
        }

        var gui;
        var sphereMeshX,sphereMeshZ,boxMeshZ,boxMeshX,lightY;
        function initGui()
        {
            gui = {
                lightY : 30,//灯光Y轴的位置
                sphereMeshX : 0,
                sphereMeshZ : 0,
                boxMeshX : 25,
                boxMeshZ : -5
            };
            var datGui = new dat.GUI();
            //将设置属性添加道歉gui当中，gui.add(对象，属性，最小值，最大值)
            datGui.add(gui,"lightY",0,100);
            datGui.add(gui,"sphereMeshX",-30,30);
            datGui.add(gui,"sphereMeshZ",-30,30);
            datGui.add(gui,"boxMeshX",0,60);
            datGui.add(gui,"boxMeshZ",-30,30);
        }

        var sphereMesh;
        var boxMesh;
       function initModel()
       {
           //添加辅助线
           var helper = new THREE.AxesHelper(100);
           scene.add(helper);

           //平面
           var planeGeometry = new THREE.PlaneGeometry(80,60,1,1);
           var planeMaterial = new THREE.MeshPhongMaterial({color:0xaaaaaa,side:THREE.DoubleSide});
           var planeMesh = new THREE.Mesh(planeGeometry,planeMaterial);
           planeMesh.rotation.x = - 0.5*Math.PI;
           planeMesh.rotation.y = - 0;
           planeMesh.receiveShadow = true;//告诉底部平面需要接收阴影
           scene.add(planeMesh);

           //上面的球
           var sphereGeometry = new THREE.SphereGeometry(5,20,20);
           var sphereGeometryMaterial = new THREE.MeshPhongMaterial({color:'Violet',side:THREE.DoubleSide});
           sphereMesh = new THREE.Mesh(sphereGeometry,sphereGeometryMaterial);
           sphereMesh.position.y = 5;
           sphereMesh.castShadow = true;//告诉球需要投射阴影
           scene.add(sphereMesh);

           //立方体
           var boxGeometry = new THREE.BoxGeometry(10,10,8);
           var boxMaterial = new THREE.MeshPhongMaterial({color:'DeepSkyBlue',side:THREE.DoubleSide});
           boxMesh = new THREE.Mesh(boxGeometry,boxMaterial);
           boxMesh.position.set(25,5,-5);
           boxMesh.castShadow = true;//告诉立方体需要生成阴影
           scene.add(boxMesh);
       }

        //初始化性能插件
        var stats;
        function initStats()
        {
            stats = new Stats();
            document.body.appendChild(stats.dom);
        }

        var controls;
       function initOrbitControls()
       {
           controls = new THREE.OrbitControls(camera,renderer.domElement); 
       }

       function render()
       {
           renderer.render(scene,camera);
       }

       //窗口变触发的函数
       function onWindowResize()
       {
           camera.aspect = window.innerWidth / window.innerHeight;//重置相机的宽高比
           camera.updateProjectionMatrix();//更新透视矩阵
           renderer.setSize(window.innerWidth,window.innerHeight);//设置渲染器的canvas画布大小
       }

       function animate()
       {
            //更新控制器
            controls.update();
            render();
            //更新性能插件
            stats.update();

            light.position.y = gui.lightY;
            sphereMesh.position.x = gui.sphereMeshX;
            sphereMesh.position.z = gui.sphereMeshZ;
            boxMesh.position.x = gui.boxMeshX;
            boxMesh.position.z = gui.boxMeshZ;
            
            requestAnimationFrame(animate);//系统适时回调函数

       }

       function draw()
       {
           initRender();
           initScene();
           initCamera();
           initLight();
           initModel();
           initOrbitControls();
           initStats();
           initGui();

           animate();
           window.onresize = onWindowResize;//窗口变动回调函数
       }
       draw();
       console.log(scene.children);
    </script>
    
</body>
</html>

